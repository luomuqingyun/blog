---
title: CAN 总线简介
date: 2025-05-19 14:42:00
---


![](https://files.mdnice.com/user/38598/ab6dc1e1-ff02-46f9-863f-9a2eb0f39eda.png)

前面的文章中介绍过单片机开发常用通信协议中的UART，IIC，SPI三种。这三种通信协议是平时项目开发过程中使用概率最高的，市面上使用的多数芯片或电子模块都会带有其中一种或几种。这三种通信协议也是最基础，最容易实现的，它们的抗干扰能力也相对较弱，所以它们通常不适合用做长距离通信，一般用于近距离的，比如芯片间通信或板间通信。如果做稍微长距离的通信，对数据的可靠性要求更高就需要控制速率或做一些特殊处理或使用其他相对抗干扰更强的通信协议，比如CAN，TCP/IP等。其中，CAN总线是一种被广泛应用于工业控制的通信协议，是应用最广泛的现场总线之一，接下来我们一起来了解它。
![](https://files.mdnice.com/user/38598/8afb8303-08a2-4fc8-8cee-341d5c3c95d9.png)

## CAN总线历史

![CAN总线协议发展历史](https://files.mdnice.com/user/38598/7e52cbf1-ecd8-4e54-b689-90a4cbec247f.png)

CAN（Controller Area Network）总线，即控制器局域网总线，是一种功能丰富的车用总线标准。该协议最初是由德国博世（Bosch）公司在1983年制定的，之后在美国密歇根州底特律举行的汽车工程师协会(SAE) 会议上正式发布推出。1987年，Intel公司推出的首款CAN总线芯片（82526）上市销售。1991年，奔驰汽车发布的第一款基于CAN总线的多路布线系统汽车——W140量产，1993年，国际标准化组织（ISO）发布了CAN标准ISO 11898。后来CAN标准被重新编译分成两个部分：ISO 11898-1涵盖了数据链路层，ISO 11898-2涵盖了高速CAN总线的物理层，所以ISO 11898是针对通信速率为125Kbps~1Mbps的高速通信标准。与此同时，还有另一个标准ISO 11519是针对通信速率为125Kbps以下的低速CAN通信标准，不过ISO 11519后来被此后发布的ISO 11898-3:2006所替代。当然，现在新版的CAN总线芯片支持的通信速率最高波特率也已达5Mbps。

![奔驰W140](https://files.mdnice.com/user/38598/416b973b-dae6-42c0-9c95-4a05de57af5a.png)

至今，CAN总线依然还在不断扩展、完善和提升，所以标准也还在不停更新，目前在用CAN总线版本分为2.0A、2.0B、FD，并且新一代的协议标准也即将推出。当前，CAN总线也是五个应用于车载诊断 (OBD)-II标准的协议之一，现在世界范围内大部分国家都会强制要求生产的汽车必须带有OBD2接口，所以有兴趣的朋友可以通过此接口读取车辆信息，DIY一些有趣的应用。

![汽车OBD2接口](https://files.mdnice.com/user/38598/c1db1a71-3a2d-4416-9933-e139c08a4889.png)

汽车产业中，出于对安全性、舒适性、方便性、绿色环保节能的要求，各种各样的电子控制系统不断被开发出来。由于这些系统之间通信所用的数据类型及对可靠性的要求不尽相同，由多条总线构成的情况很多，线束的数量也随之增加。CAN总线是一种基于消息传递的协议，设计之初就是为了在车辆上实现复用通信线缆，以降低铜线使用量。它是一种异步串行通讯低层网络，用于在不需要主机的情况下实现网络上的微控制器和各仪器之间相互通信。它可以提高系统性能，简化控制系统，提高可靠性和灵活性。

![现代车辆电路网络分布](https://files.mdnice.com/user/38598/c91e86e5-4208-41a5-b902-e09a7bcc651d.png)

CAN总线标准具有非常多的优势，它可以支持高速数据传输，并且可以支持多种不同的物理层协议，数据传输协议，应用层协议和网络类型。它具有较高的安全性和可靠性，可以支持多种不同的应用场景，可以支持节点之间的自动发现和自动配置，可以支持大量的节点，并且可以同时处理多个节点之间的数据传输。

![汽车CAN总线应用](https://files.mdnice.com/user/38598/d7488fbd-6707-4d4a-8a05-e261ee099c0e.png)

如今，经过数十年的发展CAN总线的应用早已不局限于车辆工程领域，它已被应用于各种控制领域，比如航空，航海，医疗器械，物联网，自动化，建筑机械电子等各种工业控制领域。

![CAN总线应用场景举例](https://files.mdnice.com/user/38598/13ecff57-5631-45af-84ba-1c3faa39e109.png)

## ISO/OSI模型

ISO/OSI基本参照模型是一种概念模型，由国际标准化组织提出，是一个试图使各种计算机在世界范围内互连为网络的标准框架，其定义于ISO/IEC 7498-1。该模型将通信系统中的数据流划分为七个层，从分布式应用程序数据的最高层表示到跨通信介质传输数据的物理实现。每个中间层为其上一层提供功能，其自身功能则由其下一层提供，功能的类别通过标准的通信协议在软件中实现，类比TCP/IP网络协议模型。

![ISO/OSI基本参照模型](https://files.mdnice.com/user/38598/88e07985-1be5-4488-b12f-1cc89960eee1.png)

![TCP/IP计算机网络协议模型](https://files.mdnice.com/user/38598/d6e33615-d9b6-4c39-8ec2-50b1e565f878.png)


## CAN总线的硬件实现

![CAN网拓扑结构](https://files.mdnice.com/user/38598/8716b1e7-d980-4fce-a686-d9e555142a13.png)

CAN总线的物理层使用双绞线作为网络介质，两个信号分别称作CAN_HI和CAN_LO，他们组成一对差分信号，由CAN总线节点的物理层接口———总线收发器驱动。

但是它的具体硬件电路实现有两种模式，分别对应前面提到的高速标准和低速标准电路，其中高速、短距离的是“闭环网络”，它的总线最大长度为40m，通信速度最高为1Mbps，总线的两端各要求有一个“120 欧”的电阻。

![CAN总线高速标准硬件电路](https://files.mdnice.com/user/38598/f3079a53-2e6e-4962-be05-ec4a42010eac.png)

另外一种低速、远距离的“开环网络”，它的最大传输距离为1km，最高通讯速率为125Kbps，两根总线是独立的、不形成闭环，要求每根总线上各串联有一个“2.2 千欧”的电阻。

一般情况下一辆汽车上会包含高速和低速两种线路，会根据数据需求的紧急程度来确定哪些信息使用高速通信线路。

![汽车CAN总线控制网络分布](https://files.mdnice.com/user/38598/54973f8e-d997-4e58-aac4-d0ee87826dc0.png)

CAN总线通信信号与两线电平关系：
- 总线电平 = CAN_H 的电压 – CAN_L 的电压。
- 显性电平对应逻辑 0，CAN_HI拉高，CAN_LO拉低。
- 隐性电平对应逻辑 1，CAN_HI，CAN_LO均浮空。

CAN总线的规范中，将二进制位‘0’定义为“显性位”或“显性信号”、‘1’定义为“隐性位”或“隐性信号”。在传输显性位‘0’时，CAN_HI信号将被拉高到CAN总线收发器的工作电源电压VDD，同时CAN_LO信号将被拉低到CAN总线收发器GND。传输隐性位‘1’时，CAN总线收发器不驱动CAN_HI和CAN_LO两个信号，即两个信号处于浮空状态。两种通信速率电路的电平信号稍有不一样，但处理方式相通。

![两种速率信号对比](https://files.mdnice.com/user/38598/9d30ef11-da48-4784-827c-69e301abf942.png)


## CAN总线协议

CAN总线协议主要定义了ISO/OSI基本参照模型中的数据链路层及物理层两层，其他部分内容ISO并未进行标准化定义，这些模型层中除ISO之外其他一些组织架构或公司根据自身使用定义了一些标准，比如前面提到的汽车OBD接口可能包含很多种应用层的协议标准类型。

![CAN总线协议模型](https://files.mdnice.com/user/38598/d768b834-9d30-4df4-af4d-6da5a6fecae4.png)

![CAN总线协议与OBD联系](https://files.mdnice.com/user/38598/ac94e014-0634-4b52-8e9e-15dd0451e18b.png)

CAN总线是一种多主(或无主)网络架构，任何节点都可以随时启动消息发送过程，但是发送者必须在发送消息ID期间侦测网络状态确保是否发送成功，一旦发送不成功则停止发送过程，直到网络恢复空闲状态后再次启动发送过程。CAN总线发送帧/消息ID和远程请求标志位的过程称作抢占总线的仲裁过程。

CAN有4种帧类型（部分资料将帧间隔也算作帧格式的一种，就是5种帧）：
- 数据帧：包含用于传输的节点数据的帧。
- 远程帧：请求传输特定标识符的帧。
- 错误帧：由任何检测到错误的节点发送的帧。
- 过载帧：在数据帧或远程帧之间插入延迟的帧。

![帧与用途](https://files.mdnice.com/user/38598/f2d9fda6-1b48-40ff-9c93-fc8ae1b4185c.png)

数据帧是唯一用于实际数据传输的帧，CAN总线的数据帧是面向二进制位编码的结构化位流，每个数据帧都包含帧起始域、仲裁域、控制域、数据域、CRC校验域、确认域、帧结束域和帧间隔域等，所有的帧都以开始位（SOF）作为信息传输的起始。

![数据帧格式](https://files.mdnice.com/user/38598/fa3ad6e1-05ea-409f-b403-1fb452e7ff12.png)

CAN总线信息可以配置为使用两种不同的帧格式：标准或基本帧格式和扩展帧格式。两种格式之间的唯一区别是，标准帧标识符长度为11位，扩展帧标识符长度为29位，它由11位标识符（标准标识符）和一个18位扩展组成。CAN标准帧格式和CAN扩展帧格式之间是通过使用IDE位进行区分的，该位在传输显性时（即为0）为11位帧，而在传输隐性时使用29位帧。支持扩展帧格式消息的CAN控制器也能够发送和接收CAN基本帧格式信息。

![标准格式数据信息](https://files.mdnice.com/user/38598/d98d55f2-8ec0-42c6-b9e1-72eb7e8dc107.png)

![扩展格式数据信息](https://files.mdnice.com/user/38598/26beead5-bf06-452b-a7e1-e7d182fbc010.png)

![数据帧传输过程示意](https://files.mdnice.com/user/38598/a371964f-aed3-427c-8111-f3feccf365c8.png)

通常数据传输是在数据源节点（例如传感器）发出数据帧的情况下自主执行的。但是，目标节点也可以通过发送远程帧来从信息源请求数据，即为远程帧。

数据帧和远程帧之间有两个区别:
- RTR位在数据帧中作为显性位传输，
- 远程帧中没有数据段。DLC字段表示所请求的消息的数据长度，而不是发送的数据长度。

在数据帧和具有相同标识符的远程帧同时发送的情况下，由于数据帧标识符之后的RTR位是显性，它将赢得仲裁。

![远程帧格式](https://files.mdnice.com/user/38598/5751b294-52e2-45c4-a06c-625d8c6cef0a.png)

错误帧由两个不同的字段组成：
- 第一段由不同站点提供的错误标志（6-12个显性位/隐性位）的叠加给出。
- 接下来的第二段是错误帧定界符（ERROR DELIMITER，8个隐性位）。

错误标志也有两种：
- 主动错误标志:
六个显性位 - 由网络上错误状态为“主动错误”的出错的节点传送。
- 被动错误标志
六个隐性位 - 由网络上错误状态为“被动错误”的出错的节点传送。

![错误帧格式](https://files.mdnice.com/user/38598/f431cdae-9d39-4ebf-bb9a-24de53b43962.png)


过载帧包含两个位字段：过载标志（Overload Flag）和过载定界符（Overload Delimiter）。

有两种过载条件可导致过载标志的传输：
- 1.接收器的内部条件，要求延迟下一个数据帧或远程帧。
- 2.中断检测到一个显性位。

![过载帧格式](https://files.mdnice.com/user/38598/d57f1fc0-e2c5-4d44-bb2e-c6bbbcd76109.png)


![](https://files.mdnice.com/user/38598/797b1bfe-686c-4a53-a326-9326707ca46a.png)



----

占位

>>>文章内容为作者个人观点，难免有疏忽或错误，若有不同见解可以交流评论，若发现错误还请指正，若认同文章观点，欢迎关注，分享。

>>如学习需要或项目开发合作可以扫码添加微信。
>>![](https://files.mdnice.com/user/38598/6fbcd253-edc6-4175-ba0c-44e24ad33b21.jpg)
>>
>>建有电子开发交流群，供平时交流、学习，如果要进群，加好友时记得备注信息`进群`，未备注则默认不邀请进群，进群后请遵守群规。
>>
>>**注意：加好友的人比较多，为提高交流效率，尽量不要无意义的提问，毕竟大家都是成年人了，当然闲聊除外**

`温馨提示：部分文章中附有分享文件，若需要获取，进入公众号后台发送文章中提示的关键词，即可自动获取。请不要在留言或个人微信聊天界面发送关键词，留言区没有机器人回复，个人聊天默认不回复此类信息，望悉知！！！`

#### 推荐阅读
- [PID算法基础汇总](https://mp.weixin.qq.com/s?__biz=MzI1OTQ4MTg4Ng==&mid=2247486549&idx=1&sn=aa7a3ea1c22bd5b797986314e4aa0e2c&chksm=ea790424dd0e8d32da20a9219be731e7691ce1711f2e6b42fc144e3586fe53ff41c3070df904&token=241279816&lang=zh_CN#rd)
- [怎么快速上手一款新的MCU](https://mp.weixin.qq.com/s?__biz=MzI1OTQ4MTg4Ng==&mid=2247485581&idx=1&sn=b36e6536717774f7931c7aa93d5b237a&chksm=ea7900fcdd0e89ea0db13737720edc996fcb3fdbab3e43b4a92316240ac66d4b5a8bf9a07e78&token=466212876&lang=zh_CN#rd)
- [初学者看得懂代码却写不出怎么办](https://mp.weixin.qq.com/s?__biz=MzI1OTQ4MTg4Ng==&mid=2247485862&idx=1&sn=830ede5ac467c8d396adfbea141f0526&chksm=ea7901d7dd0e88c1e8e5396305ab83c6fbd884cf356ad64c54463230364e865a1659f193dd1f&token=63320980&lang=zh_CN#rd)
- [51单片机入门看这一篇就够了](https://mp.weixin.qq.com/s?__biz=MzI1OTQ4MTg4Ng==&mid=2247485523&idx=1&sn=b7fcd1b86e2467d6f03b1a520c39bb06&chksm=ea790022dd0e893452c4994fa16d63111b16d9878c303712f695b58b7af360b7b18c1ed4b201&token=1711068967&lang=zh_CN#rd)
- [实用单片机、电子开发小工具集](https://mp.weixin.qq.com/s?__biz=MzI1OTQ4MTg4Ng==&mid=2247485606&idx=1&sn=2b433faa2e436fc762dc538c9cf3fe14&chksm=ea7900d7dd0e89c169f8948ff3d423016c8f51f1c914eb7b0d20cba8145b9ffa54815915d67b&token=1580674001&lang=zh_CN#rd)
- [Keil软件如何高效格式化代码](https://mp.weixin.qq.com/s?__biz=MzI1OTQ4MTg4Ng==&mid=2247485572&idx=1&sn=17cefa35d9d660083d419a7e9b6db6f7&chksm=ea7900f5dd0e89e35b65ba26354cc69ad24f686d8e18abd34e0932567a9345e8c9ed653eee6b&token=1711068967&lang=zh_CN#rd)
- [两个电子开发初学者用得上的工具](https://mp.weixin.qq.com/s?__biz=MzI1OTQ4MTg4Ng==&mid=2247485987&idx=1&sn=106e52add61999ae4bddd8b28c7ed2b1&chksm=ea790252dd0e8b44e36e26f20153b1bd73a0fff98ef3c50330358435a9dfac2d97e04a30d59e&token=63320980&lang=zh_CN#rd)
- [windows平台上非常实用的小工具](https://mp.weixin.qq.com/s?__biz=MzI1OTQ4MTg4Ng==&mid=2247485420&idx=2&sn=728ca4abbadf7caf51c392e7d7045cbe&chksm=ea790f9ddd0e868b9fa162c80db1876199845f387bbe851c8d38a4e8412329ae635916c13cfb&token=1711068967&lang=zh_CN#rd)
- [51单片机入门学习推荐书单](https://mp.weixin.qq.com/s?__biz=MzI1OTQ4MTg4Ng==&mid=2247485689&idx=3&sn=d4c0d26781f307ffd26defdc4022c928&chksm=ea790088dd0e899e2872692b9568309e779acfc515e82c28a853d4228de2e2b8f7ee7149913f&token=63320980&lang=zh_CN#rd)
- [零基础电子技术知识集合](https://mp.weixin.qq.com/s?__biz=MzI1OTQ4MTg4Ng==&mid=2247485689&idx=4&sn=211c2d0871a19c5e92cdf0c34f01d96b&chksm=ea790088dd0e899e3042a649a346bc98e94189d1fd18da2b954a7ddb781582dc2d0a82e07f4d&token=970763775&lang=zh_CN#rd)
----
